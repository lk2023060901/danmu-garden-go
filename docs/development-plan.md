# 开发周期与优先级规划

本文档描述从 0 到 1 搭建分布式游戏服务器的开发周期（约 10–12 周）以及功能优先级划分。

## 一、角色与团队假设（后端）

- 团队规模：3–5 人（仅后端相关）。
  - 后端工程师：2–3 人（Go）。
  - QA 测试：1 人。
  - 产品/策划、运维按需要参与。

## 二、开发周期（阶段划分）

### 第 1–2 周：需求与方案设计

- 明确游戏玩法、房间模型、并发目标。
- 明确抖音侧交互流程（授权、回调事件、限流要求等）。
- 产出：
  - 架构设计文档（参见 `architecture.md`）。
  - 接口定义初稿（`api/proto`、`api/http` 草稿）。
  - 数据库和缓存初步模型。

### 第 3–4 周：基础设施搭建

- 搭建项目骨架和目录结构（参见 `project-structure.md`）。
- 集成基础组件：
  - 日志（zap）、配置（viper）、监控（Prometheus）、链路追踪（OpenTelemetry）。
  - PostgreSQL、Redis、MQ 客户端封装。
- 搭建 CI/CD 与基础 K8s 部署流程。

### 第 5–6 周：核心链路 P0 打通

- 抖音 Server SDK 接入：
  - 完成签名验证、回调处理、授权流程基础实现。
- 网关服务：
  - 实现 WebSocket/gRPC 接入、长连接管理、心跳、简单消息转发。
- 用户基础能力：
  - 抖音账号绑定、UID 管理、基础用户信息存储。
- 确保端到端后端链路：抖音 → 网关 → 各后端服务 可以跑通简单 demo，接口稳定。

### 第 7–8 周：匹配与游戏逻辑

- 匹配/房间服务：
  - 实现基础匹配逻辑（随机匹配/简单段位匹配）。
  - 实现房间创建、进入、退出、结束等生命周期。
- 游戏服务：
  - 实现首个可玩的游戏模式整局流程（开始 → 对局中 → 结算）。
- 完成后端功能并通过接口联调验证，产出可支持客户端接入的 MVP 版本。

### 第 9–10 周：性能优化与高可用

- 进行压测：
  - 网关长连接能力。
  - 游戏服务 QPS/延迟。
  - Redis/PG 瓶颈点识别与优化。
- 增强稳定性：
  - 限流、熔断、降级策略。
  - 完善日志与监控看板，加入必要的告警规则。
- 故障演练：
  - 模拟节点宕机、部分服务不可用，验证恢复与降级策略。

### 第 11–12 周：安全、灰度与上线

- 安全性与风控：
  - 基础防刷、防作弊策略。
  - 参数校验、权限校验、异常行为监控。
- 上线策略：
  - 灰度发布和按区域或比例放量。
  - 制定回滚方案和操作手册。
- 文档与培训：
  - 完善开发、运维、排障文档。

## 三、功能优先级划分

### P0：必须完成（最小可用版本）

- 接入与基础设施
  - 抖音 Server SDK 接入（鉴权、签名、回调）。
  - 网关服务（WebSocket/gRPC）+ 长连接管理 + 心跳。
  - PostgreSQL & Redis 基础接入与配置。
  - 日志、基础监控指标和简单告警。
- 核心业务链路
  - 用户体系：抖音账号绑定、UID、基础用户信息。
  - 匹配服务：发起匹配、取消匹配、房间分配。
  - 房间与游戏流程：进入房间、开始对局、简单事件处理、结算。

### P1：重要（提升稳定性与体验）

- 游戏与平台能力
  - 完善匹配算法（段位、段位差、等待时间的权衡）。
  - 游戏内更多事件与更优状态同步策略（减少带宽、降低延迟）。
  - 排位/段位系统、基础排行榜。
- 系统与运行能力
  - 更完善的限流、熔断、降级策略。
  - 更细粒度的监控和 tracing（按房间、按用户、按接口）。
  - 配置中心，支持动态调整阈值和开关。
  - 初步防刷、防外挂规则（如操作频率限制、异常行为检测）。

### P2：增强功能与运营能力

- 游戏周边体验
  - 战报分享、对局回放（基于对局日志）。
  - 成就系统、每日任务等留存机制。
  - 社交功能（好友、组队、战队等）。
- 运营与数据
  - 运营后台：实时在线、留存、付费、对局质量等数据看板。
  - A/B 测试能力，用于快速实验不同策略（匹配权重、奖励系数等）。
  - 自动化运维工具（自动扩容、热房间调度等）。

## 四、里程碑与验收标准

- 里程碑 M1（第 4 周结束）：
  - 项目骨架完成，基础设施联通，能跑通简单的健康检查接口。
- 里程碑 M2（第 6 周结束）：
  - 抖音接入 + 网关 + 用户基础能力打通，具备端到端 demo。
- 里程碑 M3（第 8 周结束）：
  - 完整一局可玩的游戏流程上线测试环境。
- 里程碑 M4（第 10 周结束）：
  - 面向 1 万并发的压测通过，核心稳定性策略就绪。
- 里程碑 M5（第 12 周结束）：
  - 安全/灰度策略完成，文档完善，具备正式上线条件。

以上规划可根据团队实际规模和需求变化进行微调，但建议保持 P0 功能优先落地，以尽早拿到可运行版本进行验证和迭代。
